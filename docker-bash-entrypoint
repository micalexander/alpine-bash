#!/bin/bash
app_dir=$(pwd)

append_line "/etc/sudoers" "PATH PYTHONPATH LD_LIBRARY_PATH" 'Defaults env_keep += "PATH PYTHONPATH LD_LIBRARY_PATH"'
append_line "/etc/sudoers" "${DEV_USER}" "${DEV_USER} ALL=(ALL) NOPASSWD:ALL"

if ! [[ `id -u ${DEV_USER} 2>/dev/null || echo -1` -ge 0 ]]; then

  adduser -D -g ${DEV_USER} ${DEV_USER} -s /bin/bash
  sudo -u "${DEV_USER}" -E -i /bin/bash touch $HOME/.newuser

fi

sudo -u "${DEV_USER}" -E -i /bin/bash <<-'EOF'

  if [[ -f "$HOME/.newuser" ]]; then

    docker-bash-pathways

    source $HOME/.bash_profile

    docker-bash-globals

    rm $HOME/.newuser
  fi

EOF

tail -f /dev/null
